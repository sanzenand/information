<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sanzen — bio & отзывы</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet">
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self' https:; script-src 'self' https://telegram.org 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https:; connect-src 'self' https://api.github.com;">
  <style>
    :root{--bg:#07060a;--card:rgba(255,255,255,0.02);--muted:#9aa7bf;--accent:#6b46c1;--radius:12px;--maxw:980px}
    *{box-sizing:border-box}
    body{margin:0;min-height:100%;font-family:Inter,system-ui,Arial,color-scheme:dark;color:#e8eef8;background:#0b0b0e url('https://images.unsplash.com/photo-1614064642307-29f7c3a5f3b3?auto=format&fit=crop&w=1920&q=80') center/cover fixed}
    .wrap{min-height:100vh;backdrop-filter:blur(6px);background:linear-gradient(180deg,rgba(2,6,23,0.55),rgba(2,6,23,0.7));display:flex;align-items:flex-start;justify-content:center;padding:40px 16px}
    .card{width:100%;max-width:var(--maxw);background:var(--card);border-radius:var(--radius);padding:20px;box-shadow:0 12px 40px rgba(2,6,23,0.6)}
    header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:14px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#ff4d6d);display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff}
    h1{margin:0;font-size:18px}
    .sub{color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:1fr 320px;gap:16px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
    .section{background:rgba(255,255,255,0.02);padding:14px;border-radius:10px}
    .links a{display:block;color:#fff;text-decoration:none;padding:8px;border-radius:8px;margin-bottom:8px;background:linear-gradient(90deg,rgba(255,255,255,0.02),rgba(0,0,0,0.04));border:1px solid rgba(255,255,255,0.02)}
    .h{font-weight:700;margin-bottom:8px}
    .muted{color:var(--muted);font-size:13px}
    .reviews-list .rev{padding:10px;border-radius:8px;background:rgba(0,0,0,0.35);margin-bottom:10px;border:1px solid rgba(255,255,255,0.02)}
    .rev .meta{font-size:13px;color:var(--muted);margin-bottom:6px}
    .posts-list .post{padding:10px;border-radius:8px;background:rgba(0,0,0,0.28);margin-bottom:10px;border:1px solid rgba(255,255,255,0.02)}
    .tsmall{font-size:13px;color:var(--muted)}
    footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="app">
      <header>
        <div class="brand">
          <div class="logo">S</div>
          <div>
            <h1>Sanzen / sanzsell</h1>
            <div class="sub">Продавец на FunPay • отзывы и публикации</div>
          </div>
        </div>
        <div class="tsmall">Источник отзывов: FunPay; канал отзывов: @sanzenand_fp</div>
      </header>

      <div class="grid">
        <main>
          <section class="section">
            <div class="h">О продавце</div>
            <div class="muted">Я — @sanzenand. На FunPay: отзывы и репутация. Перед покупкой ознакомьтесь с информацией и правилами; не прошу участвовать в незаконных схемах.</div>
          </section>

          <section class="section" style="margin-top:12px">
            <div class="h">Отзывы с FunPay</div>
            <div class="muted">Автоматически обновляются из репозитория через GitHub Actions.</div>
            <div id="reviews" class="reviews-list" style="margin-top:10px">
              <div class="tsmall">Загрузка отзывов…</div>
            </div>
          </section>

          <section class="section" style="margin-top:12px">
            <div class="h">Посты с TG‑канала (sanzenand_fp)</div>
            <div class="muted">Копии постов автоматически импортируются из канала и отображаются ниже.</div>

            <!-- Встроенный пост №2 (официальный виджет) -->
            <div style="margin:12px 0">
              <script async src="https://telegram.org/js/telegram-widget.js?22" data-telegram-post="sanzenand_fp/2" data-width="100%"></script>
            </div>

            <div id="tgposts" class="posts-list" style="margin-top:10px">
              <div class="tsmall">Загрузка постов…</div>
            </div>
          </section>
        </main>

        <aside>
          <div class="section links">
            <div class="h">Контакты</div>
            <a href="https://t.me/Sanzenand" target="_blank" rel="noopener noreferrer">Telegram — @Sanzenand</a>
            <a href="https://t.me/mainsanzenand" target="_blank" rel="noopener noreferrer">БИО канал — @mainsanzenand</a>
            <a href="https://t.me/sanzenand_fp" target="_blank" rel="noopener noreferrer">Отзывы TG‑канал — @sanzenand_fp</a>
            <a href="https://discord.gg/XwbxSpvC8z" target="_blank" rel="noopener noreferrer">Discord</a>
            <a href="https://funpay.com/users/11006828/" target="_blank" rel="noopener noreferrer">FunPay — Sanzenand</a>
          </div>

          <div class="section" style="margin-top:12px">
            <div class="h">Как публиковать</div>
            <div class="muted">Отзывы: собираются с FunPay автоматически. Посты: публикуй в TG‑канале @sanzenand_fp — Action импортирует их.<br><br>Если нужно — можно добавить шаблон Issues в репозитории для ручной публикации.</div>
          </div>

          <div class="section" style="margin-top:12px">
            <div class="h">Безопасность</div>
            <div class="muted">Данные отображаются из JSON-файлов в репозитории; текст экранируется и не выполняется как HTML/скрипты.</div>
          </div>
        </aside>
      </div>

      <footer>© 2025 Sanzen • Обновление данных через GitHub Actions</footer>
    </div>
  </div>

  <script>
    const REVIEWS_JSON = './reviews.json';
    const TGPOSTS_JSON = './tg_posts.json';

    function escapeText(s){
      if(!s) return '';
      return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }

    async function fetchJSONNoCache(url){
      try{
        const res = await fetch(url, {cache: "no-cache"});
        if(!res.ok) return null;
        return await res.json();
      }catch(e){
        return null;
      }
    }

    async function renderReviews(){
      const container = document.getElementById('reviews');
      const data = await fetchJSONNoCache(REVIEWS_JSON);
      if(!data || !Array.isArray(data) || data.length===0){
        container.innerHTML = '<div class="tsmall">Отзывов пока нет. Дождитесь запуска workflow или проверьте logs Actions.</div>';
        return;
      }
      container.innerHTML = '';
      data.forEach(r => {
        const author = escapeText(r.author || 'Пользователь');
        const rating = escapeText(r.rating || '');
        const text = escapeText(r.text || '');
        const time = escapeText(r.time || '');
        const el = document.createElement('div');
        el.className = 'rev';
        el.innerHTML = `<div class="meta">${author} ${rating ? '• ' + rating : ''} <span style="color:var(--muted)">• ${time}</span></div><div>${text}</div>`;
        container.appendChild(el);
      });
    }

    async function renderTGPosts(){
      const container = document.getElementById('tgposts');
      const data = await fetchJSONNoCache(TGPOSTS_JSON);
      if(!data || !Array.isArray(data) || data.length===0){
        container.innerHTML = '<div class="tsmall">Постов пока нет. Дождитесь запуска workflow или проверьте logs Actions.</div>';
        return;
      }
      container.innerHTML = '';
      data.forEach(p => {
        const time = escapeText(p.time || '');
        const text = escapeText(p.text || '');
        const link = escapeText(p.link || '');
        const el = document.createElement('div');
        el.className = 'post';
        el.innerHTML = `<div class="meta">${link ? `<a href="${link}" target="_blank" rel="noopener noreferrer">${link}</a>` : ''} <span style="color:var(--muted)">• ${time}</span></div><div style="margin-top:6px">${text.replace(/\n/g,'<br>')}</div>`;
        container.appendChild(el);
      });
    }

    (async function init(){
      await renderReviews();
      await renderTGPosts();
      setInterval(async ()=>{
        await renderReviews();
        await renderTGPosts();
      }, 180000);
    })();
  </script>
</body>
</html>
